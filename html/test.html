<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

</head>
<body>

    Clients:
    <ul id="clients"></ul>

    <div id="login-box">
        <input type="text" placeholder="PrÃ©nom">
        <button> S'identifier ! </button>
    </div>

    <div id="message-box" style="display: none;">
        <input type="text" placeholder="Mon message">
        <button> Envoyer le message ! </button>
    </div>

    Messages:
    <ul id="messages"></ul>

    <script>

        window.addEventListener('DOMContentLoaded', () => {

            var socketioServer = io('http://localhost:3000/');


            //logic login
            document.querySelector('#login-box button').addEventListener('click', () => {

                let firstname = document.querySelector("#login-box input").value

                socketioServer.emit("authentification", firstname)

                document.querySelector("#login-box").style.display = "none"
                document.querySelector("#message-box").style.display = "block"

            })

            //logic message
            document.querySelector('#message-box button').addEventListener('click', () => {

                let message = document.querySelector("#message-box input").value

                socketioServer.emit("newMessage", message)

                let li = document.createElement('li')
                li.innerText = `Moi: ${message}`

                document.querySelector("#messages").appendChild( li )

            })

            socketioServer.on('newMessageReceived', (message) => {

                let li = document.createElement('li')
                li.innerText = message

                document.querySelector("#messages").appendChild( li )

            })

            //logic socket
            socketioServer.on('newAuthentification', (firstname) => {
                // alert("HEY ON A UN NOUVEAU VENU QUI EST : " + firstname)

                let li = document.createElement('li')
                li.innerText = firstname

                document.querySelector("#clients").appendChild( li )

            })

            socketioServer.on('messages', (messages) => {

                messages.forEach((message) => {
                    let li = document.createElement('li')
                    li.innerText = message

                    document.querySelector("#messages").appendChild( li )

                })

            })
            
        })

      </script> 

</body>
</html>